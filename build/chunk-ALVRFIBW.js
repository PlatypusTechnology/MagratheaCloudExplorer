import{a as we}from"./chunk-UA7JOUUL.js";import{a as ge}from"./chunk-K5UGPKOS.js";import{A as n,B as c,Da as ne,Ea as se,Fa as M,Ja as le,K,M as a,Mb as N,Pb as b,R as s,Rb as D,S as p,Sb as V,T as d,Vb as ve,Wb as I,X as Y,Y as v,Z as h,bb as pe,c as te,ca as O,cb as E,da as G,e as P,ea as Q,eb as W,ga as L,h as T,ha as $,i as ie,ia as ae,ib as ce,j as S,jb as me,m as g,n as re,na as C,nb as de,oa as _,p as U,pa as B,pb as ue,q as X,qb as fe,rb as ye,t as oe,ta as f,tb as x,ua as w,ub as k,va as R,zb as he}from"./chunk-QBWOBUYP.js";var y=(()=>{let r=class r extends he{constructor(e){super(e)}getKeys(){let e=this.url("/keys");return this.get(e).pipe(this.defaultMap)}getById(e){let t=this.url("/key/:id").params({id:e});return this.get(t).pipe(this.defaultMap)}getByVal(e){let t=this.url("/key/:key/view").params({key:e});return this.get(t).pipe(this.defaultMap)}update(e){let t=e.id,i=this.url("/key/:id").params({id:t});return this.put(i,e)}insert(e){let t=this.url("/keys");return this.post(t,e)}getCrawlsByKey(e){let t=this.url("/key/:key/crawls").params({key:e});return this.get(t).pipe(this.defaultMap)}createCrawl(e){let t=this.url("/key/:key/crawl").params({key:e});return this.post(t,null)}executeCrawl(e,t){let i=this.url("/key/:key/crawl/:crawl/execute").params({key:e,crawl:t});return this.post(i,null)}getCrawlReport(e,t){let i=this.url("/key/:key/crawl/:crawl/report").params({key:e,crawl:t});return this.get(i)}};r.\u0275fac=function(t){return new(t||r)(S(oe))},r.\u0275prov=T({token:r,factory:r.\u0275fac});let o=r;return o})();var u=(()=>{let r=class r{constructor(e,t,i){this._state=e,this.store=t,this.api=i}getObjFromData(e){return{id:e.id,val:e.val,active:e.active,folder:e.media_folder,created_at:e.created_at,updated_at:e.updated_at}}GetKeys(){return this.api.getKeys().pipe(P(e=>e.map(t=>this.getObjFromData(t))))}GetKeyById(e){return this.api.getById(e).pipe(P(t=>this.getObjFromData(t)))}GetKeyByVal(e){return this.api.getByVal(e).pipe(P(t=>this.getObjFromData(t)))}Create(e){return new Promise((t,i)=>{this.api.insert({media_folder:e}).subscribe(l=>{l.success?t(!0):i(l)})})}Save(e){return new Promise((t,i)=>{e.id!=null?this.api.update(e).subscribe(l=>t(l.success)):this.api.insert(e).subscribe(l=>{l.success?t(!0):i(l)})})}selectKey(e){this.store.set("key-val",e.val),this.store.set("key-folder",e.folder),this._state.emit("key.change",e)}};r.\u0275fac=function(t){return new(t||r)(S(we),S(W),S(y))},r.\u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Be=()=>({object:"Key"}),J=(()=>{let r=class r{constructor(e,t,i){this.transloco=e,this.nav=t,this.service=i,this.loading=!1,this.items=[],this.keys=[],this.titles={}}ngOnInit(){this.setTableData(),this.getKeys()}setTableData(){this.keys=["folder","val","created_at"],this.titles={folder:this.transloco.translate("keys.folder"),val:this.transloco.translate("keys.val"),active:this.transloco.translate("active"),created_at:this.transloco.translate("created_at")}}getKeys(){this.loading=!0,this.service.GetKeys().subscribe({next:e=>{this.loading=!1,this.items=e}})}clickKey(e){this.service.selectKey(e),this.nav.keyView()}addNew(){this.nav.keyNew()}};r.\u0275fac=function(t){return new(t||r)(c(x),c(E),c(u))},r.\u0275cmp=g({type:r,selectors:[["app-keys-list"]],standalone:!0,features:[C([y,u]),_],decls:11,vars:14,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],["icon","fa-key",3,"loading","showClose","collapsable","title"],[3,"rowClick","keys","titles","items"],[1,"col-sm-9"],[1,"col-sm-3"],["type","primary","icon","fa-key",3,"action","caption"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-window",3),f(4,"transloco"),s(5,"app-table",4),v("rowClick",function(z){return i.clickKey(z)}),p()()()(),s(6,"div",1),d(7,"div",5),s(8,"div",6)(9,"app-button",7),f(10,"transloco"),v("action",function(){return i.addNew()}),p()()()()),t&2&&(n(3),a("loading",i.loading)("showClose",!1)("collapsable",!1)("title",w(4,8,"keys.list-title")),n(2),a("keys",i.keys)("titles",i.titles)("items",i.items),n(4),a("caption",R(10,10,"new",B(13,Be))))},dependencies:[I,b,ve,D,k]});let o=r;return o})();var Re=()=>({object:"Key"}),A=(()=>{let r=class r{constructor(e,t,i,l,z){this.fs=e,this.transloco=t,this.toaster=i,this.nav=l,this.service=z,this.loading=!1}ngOnInit(){this.buildForm()}buildForm(){this.form=this.fs.Build(["media_folder"],["media_folder"])}save(){let e=this.fs.validate(this.form);if(!e.valid){this.toaster.error(this.transloco.translate("validation-error"));return}this.loading=!0;let t=e.data;this.service.Create(t.media_folder).then(i=>{if(this.loading=!1,i){let l=this.transloco.translate("save-success",{object:"Key"});this.toaster.success(l),this.nav.keyHome()}else{let l=this.transloco.translate("save-error",{object:"Key"});this.toaster.error(l)}}).catch(i=>this.toaster.error(i.message))}goBack(){this.nav.keyHome()}};r.\u0275fac=function(t){return new(t||r)(c(ge),c(x),c(N),c(E),c(u))},r.\u0275cmp=g({type:r,selectors:[["app-key-form"]],standalone:!0,features:[C([y,u]),_],decls:17,vars:15,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-12"],["icon","fa-key",3,"loading","showClose","collapsable","title"],[3,"formGroup","ngClass"],[1,"col-sm-8"],["id","media_folder","type","text","formControlName","media_folder","label","keys.folder",3,"required"],[1,"col-sm-4","label-margin"],["type","save",3,"action","loading"],[1,"col-sm-3"],["type","outline-primary","icon","fa-arrow-left",3,"action","caption"],[1,"col-sm-9"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-window",3),f(4,"transloco"),s(5,"form",4)(6,"div",1)(7,"div",5),d(8,"app-input",6),p(),s(9,"div",7)(10,"app-button",8),v("action",function(){return i.save()}),p()()()()()()(),s(11,"div",1)(12,"div",9)(13,"app-button",10),f(14,"transloco"),v("action",function(){return i.goBack()}),p()(),d(15,"div",11),p()(),d(16,"br")),t&2&&(n(3),a("loading",i.loading)("showClose",!1)("collapsable",!1)("title",R(4,9,"new",B(14,Re))),n(2),a("formGroup",i.form)("ngClass",i.fs.formClass(i.form)),n(3),a("required",!0),n(2),a("loading",i.loading),n(3),a("caption",w(14,12,"back")))},dependencies:[I,ne,de,ce,me,ye,ue,fe,b,D,V,k]});let o=r;return o})();var F=(()=>{let r=class r{constructor(e){this.api=e}create(e){return this.api.createCrawl(e)}getByKey(e){return this.api.getCrawlsByKey(e)}getReport(e,t){return this.api.getCrawlReport(e,t)}executeCrawl(e,t){return this.api.executeCrawl(e,t)}};r.\u0275fac=function(t){return new(t||r)(S(y))},r.\u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var Me=["reportwindow"];function Ee(o,r){if(o&1&&(s(0,"pre",6),L(1),f(2,"json"),p()),o&2){let m=h();n(),$(w(2,1,m.report))}}var Ke=(()=>{let r=class r{constructor(e,t,i){this.transloco=e,this.toaster=t,this.service=i,this.loading=!1,this.report=""}ngOnInit(){this.getReport()}getReport(){this.key!=null&&this.crawlId!=null&&this.loadReport(this.key,this.crawlId)}loadReport(e,t){this.loading=!0,console.info(`key ${e} and crawl ${t}`),this.service.getReport(e,t).subscribe({next:i=>{if(i.success){let l=i.data;this.executed=l.executed_at,this.report=l.report,this.window&&this.window.open()}else this.toaster.error(`error loading report for crawl [${this.crawlId}]`);this.loading=!1}})}};r.\u0275fac=function(t){return new(t||r)(c(x),c(N),c(F))},r.\u0275cmp=g({type:r,selectors:[["app-crawl-report"]],viewQuery:function(t,i){if(t&1&&O(Me,5),t&2){let l;G(l=Q())&&(i.window=l.first)}},inputs:{crawlId:"crawlId",key:"key"},standalone:!0,features:[C([y,u,F]),_],decls:8,vars:8,consts:[["reportwindow",""],["icon","fa-clipboard-list",3,"loading","showClose","collapsable","title"],[1,"row"],[1,"col-sm-12"],["id","crawl.execution","type","disabled","placeholder","execution date","translate","keys.crawl",3,"value"],["class","code",4,"ngIf"],[1,"code"]],template:function(t,i){t&1&&(s(0,"app-window",1,0),f(2,"transloco"),s(3,"div",2)(4,"div",3),d(5,"app-input",4),p(),s(6,"div",3),K(7,Ee,3,3,"pre",5),p()()()),t&2&&(a("loading",i.loading)("showClose",!0)("collapsable",!0)("title",w(2,6,"keys.crawl-log")),n(5),a("value",i.executed),n(2),a("ngIf",i.report))},dependencies:[I,M,b,V,le,k]});let o=r;return o})();var Ne=["reporter"],De=()=>({object:"Crawl"});function Ve(o,r){if(o&1){let m=Y();s(0,"app-button",14),v("action",function(){U(m);let t=h().$implicit,i=h();return X(i.executeCrawl(t.id))}),p()}if(o&2){let m=h(2);a("loading",m.loading)}}function Le(o,r){if(o&1){let m=Y();s(0,"app-button",15),v("action",function(){U(m);let t=h().$implicit,i=h();return X(i.viewReport(t.id))}),p()}if(o&2){let m=h(2);a("loading",m.loading)}}function Ae(o,r){if(o&1&&(s(0,"tr")(1,"td"),L(2),p(),s(3,"td"),K(4,Ve,1,1,"app-button",12)(5,Le,1,1,"app-button",13),p(),s(6,"td"),L(7),p()()),o&2){let m=r.$implicit;n(2),$(m.status),n(2),a("ngIf",m.status=="Waiting"),n(),a("ngIf",m.status!="Waiting"),n(2),ae(" ",m.executed_at?"executed at "+m.executed_at:"--"," ")}}function Pe(o,r){if(o&1&&d(0,"app-crawl-report",16,0),o&2){let m=h();a("key",m.key)("crawlId",m.reportId)}}var xe=(()=>{let r=class r{constructor(e,t,i){this.transloco=e,this.toaster=t,this.service=i,this.key="",this.loading=!1,this.crawls=[],this.title="Crawls",this.showReport=!1}ngOnInit(){this.getCrawlsByKey()}newCrawl(){let e=this.transloco.translate("keys.create-confirm");confirm(e)&&(this.loading=!0,this.service.create(this.key).subscribe({next:t=>{if(console.info(t),t.success){let i=this.transloco.translate("save-success-general");this.toaster.success(i),this.refresh()}else{let i=t.data;this.toaster.error(i.message),this.loading=!1}}}))}refresh(){this.getCrawlsByKey()}getCrawlsByKey(){if(this.key==""){this.title="No Key!";return}this.loading=!0,this.service.getByKey(this.key).subscribe({next:e=>{console.info(e),this.crawls=e,this.loading=!1}})}viewReport(e){this.loading=!0,this.showReport=!0,this.reportId=e,setTimeout(()=>this.loadReport(),1e3)}loadReport(){this.reporter?.loadReport(this.key,this.reportId),this.loading=!1}executeCrawl(e){this.loading=!0,this.service.executeCrawl(this.key,e).subscribe({next:t=>{this.loading=!1,console.info(t),this.refresh(),this.viewReport(e)}})}};r.\u0275fac=function(t){return new(t||r)(c(x),c(N),c(F))},r.\u0275cmp=g({type:r,selectors:[["app-crawl-list"]],viewQuery:function(t,i){if(t&1&&O(Ne,5),t&2){let l;G(l=Q())&&(i.reporter=l.first)}},inputs:{key:"key"},standalone:!0,features:[C([y,u,F]),_],decls:13,vars:11,consts:[["reporter",""],["icon","fa-cogs",3,"loading","showClose","collapsable","title"],["actions",""],[1,"transition",3,"click"],[1,"fa","fa-refresh"],[1,"row"],[1,"col-sm-12"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"offset-sm-8","col-sm-4"],["type","outline-primary","icon","fa-cog",3,"action","caption"],[3,"key","crawlId",4,"ngIf"],["translate","keys.execute-crawl","icon","fa-cog",3,"loading","action",4,"ngIf"],["translate","keys.view-crawl-log","icon","fa-clipboard-list",3,"loading","action",4,"ngIf"],["translate","keys.execute-crawl","icon","fa-cog",3,"action","loading"],["translate","keys.view-crawl-log","icon","fa-clipboard-list",3,"action","loading"],[3,"key","crawlId"]],template:function(t,i){t&1&&(s(0,"app-window",1)(1,"span",2)(2,"a",3),v("click",function(){return i.refresh()}),d(3,"i",4),p()(),s(4,"div",5)(5,"div",6)(6,"table",7),K(7,Ae,8,4,"tr",8),p()()(),s(8,"div",5)(9,"div",9)(10,"app-button",10),f(11,"transloco"),v("action",function(){return i.newCrawl()}),p()()()(),K(12,Pe,2,2,"app-crawl-report",11)),t&2&&(a("loading",i.loading)("showClose",!0)("collapsable",!0)("title",i.title),n(7),a("ngForOf",i.crawls),n(3),a("caption",R(11,7,"new",B(10,De))),n(2),a("ngIf",i.showReport))},dependencies:[I,se,M,b,D,k,Ke]});let o=r;return o})();function Oe(o,r){if(o&1&&d(0,"app-crawl-list",12),o&2){let m=h();a("key",m.key.val)}}var je=(()=>{let r=class r{constructor(e,t,i){this.store=e,this.nav=t,this.service=i,this.loading=!1,this.title="..."}ngOnInit(){this.loadKey()}loadKey(){return te(this,null,function*(){this.loading=!0;let e=yield this.store.get("key-val");this.service.GetKeyByVal(e).subscribe({next:t=>{console.info("got ",t),this.key=t,this.updateTitle(),this.loading=!1}})})}updateTitle(){this.title=`Key [${this.key?.val}] ==> ${this.key?.folder}`}};r.\u0275fac=function(t){return new(t||r)(c(W),c(E),c(u))},r.\u0275cmp=g({type:r,selectors:[["app-key-view"]],standalone:!0,features:[C([y,u]),_],decls:17,vars:18,consts:[[1,"container-fluid"],["icon","fa-key",3,"loading","showClose","collapsable","title"],[1,"row"],[1,"col-sm-1"],["id","key.id","type","disabled",3,"label","value"],[1,"col-sm-5"],["id","key.val","type","disabled",3,"label","value"],[1,"col-sm-4"],["id","key.folder","type","disabled","translate","keys.folder",3,"value"],[1,"col-sm-2"],["id","key.created","type","disabled",3,"label","value"],[3,"key",4,"ngIf"],[3,"key"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"app-window",1)(2,"div",2)(3,"div",3),d(4,"app-input",4),f(5,"transloco"),p(),s(6,"div",5),d(7,"app-input",6),f(8,"transloco"),p(),s(9,"div",7),d(10,"app-input",8),p(),s(11,"div",9),d(12,"app-input",10),f(13,"transloco"),p()()(),d(14,"br"),K(15,Oe,1,1,"app-crawl-list",11),p(),d(16,"br")),t&2&&(n(),a("loading",i.loading)("showClose",!1)("collapsable",!1)("title",i.title),n(3),a("label",w(5,12,"keys.id"))("value",i.key==null?null:i.key.id),n(3),a("label",w(8,14,"keys.val"))("value",i.key==null?null:i.key.val),n(3),a("value",i.key==null?null:i.key.folder),n(2),a("label",w(13,16,"created_at"))("value",i.key==null?null:i.key.created_at),n(3),a("ngIf",i.key==null?null:i.key.val))},dependencies:[I,M,b,V,k,xe]});let o=r;return o})();var Fe=[{path:"",component:J},{path:"view",component:je},{path:"edit/:id",component:A},{path:"new",component:A}];var Ge=[J,A],jt=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=re({type:r}),r.\u0275inj=ie({imports:[Ge,pe.forChild(Fe)]});let o=r;return o})();export{jt as KeysModule,Ge as components};
